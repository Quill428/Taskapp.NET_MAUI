<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:NotesApp.Models"
             x:Class="NotesApp.Views.NotesHomePage" 
             Title="Notes Home Page"
             x:DataType="models:NotesHome"
             BackgroundColor="#F5F5F5">
    <!-- Add an item to the toolbar -->
    <ContentPage.ToolbarItems backgroundcolor="black">
        <!--ToolbarItem Text="remove all" Clicked="EmptyAllNotes" IconImageSource="{FontImage Glyph='-', Color=Black, Size=22}" />
        <ToolbarItem Text="Reset Privacy" Clicked="ResetPrivacy_Clicked"/-->
        <ToolbarItem Text="Add" Clicked="Add_Clicked" IconImageSource="{FontImage Glyph='+', Color=white, Size=22}" />
    </ContentPage.ToolbarItems>

    <!-- Display notes in a list -->
    <CollectionView x:Name="notesCollection"
                ItemsSource="{Binding GroupedNotes}"
                IsGrouped="True"
                SelectionMode="Single"
                SelectionChanged="notesCollection_SelectionChanged"
                Margin="20"
                BackgroundColor="Transparent">
       

        <CollectionView.GroupHeaderTemplate>
            <DataTemplate x:DataType="models:NotesGroup">
                <Border BackgroundColor="{Binding CategoryColor}" 
                 Stroke="{Binding CategoryColor}"
                 StrokeThickness="2"
                 Padding="15,10"
                 Margin="0,10,0,5">     
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="10"/>
                    </Border.StrokeShape>
                    <Grid Padding="0,5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>                            
                        </Grid.ColumnDefinitions>
                        
                        <!-- Category Name -->
                        <Label Grid.Row="0" Grid.Column="0"
                            Text="{Binding CategoryName}"
                           FontSize="18"
                           FontAttributes="Bold"
                           VerticalOptions="Center" />


                        <!-- Delete Button -->
                        <Button Grid.Row="0" Grid.Column="1"
                            Text="ðŸ—‘ Delete"
                            Clicked="DeleteCategoryButton_Clicked"
                            FontSize="14"
                            BackgroundColor="Transparent"
                            TextColor="White"
                            WidthRequest="40"
                            HeightRequest="40"/>
                        <!--CommandParameter="{Binding CategoryName}"-->

                        <!--progress bar-->
                        <ProgressBar Grid.Row="1" Grid.Column="0"
                                     Progress="{Binding Progress, Mode=OneWay}"
                                     HeightRequest="8"
                                     VerticalOptions="Center"
                                     Margin="0,5,0,0"/>
                        <Label Grid.Row="1" Grid.Column="1"
                            Text="{Binding ProgressPercentage, StringFormat='{0:F0}% Complete'}" />

                        <!--Task Counts-->
                        <HorizontalStackLayout Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Spacing="15" Margin="0,5">
                            <Label Text="{Binding TaskCountText, StringFormat='Tasks: {0}'}"
                            FontSize="14"
                            TextColor="White"
                            FontAttributes="Bold"/>
                                <Label Text="{Binding RemainingTasksText}"
                            FontSize="14"
                            TextColor="White"/>
                        </HorizontalStackLayout>



                    </Grid>
                </Border>
            </DataTemplate>
        </CollectionView.GroupHeaderTemplate>


        <!-- Define the appearance of each item in the list -->
        <CollectionView.ItemTemplate>
            <DataTemplate x:DataType="models:Notes">
                <Border BackgroundColor="{Binding Category, Converter={StaticResource CategoryToColorConverter}}" 
                        Stroke="{Binding Category, Converter={StaticResource CategoryToColorConverter}}"
                        StrokeThickness="1"
                        Padding="15,10"
                        Margin="10,2,10,2"> <!-- Adds a coloured border around the task in the olour of the category-->
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="8"/>
                    </Border.StrokeShape>
                    <StackLayout Padding="5,0">
                        <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                            <CheckBox IsChecked="{Binding IsCompleted, Mode=TwoWay}" CheckedChanged="CheckBox_CheckedChanged" Scale="1.3"/>
                            <Label Text="{Binding Text}" FontSize="15" TextColor="Black"/>
                            <!--Label Text="{Binding Date}" FontSize="7" TextColor="Black"/-->
                        </HorizontalStackLayout>
                    </StackLayout>
                </Border>
            </DataTemplate>
        </CollectionView.ItemTemplate>
    </CollectionView>
</ContentPage>

    